<div class="um-toolbar">
  <app-section-title></app-section-title>
  <app-button
      icon="add"
      label="Add Role"
      (click)="handleAddRole()">
  </app-button>
</div>

<div class="card">
    <div class="card-toolbar">
      <div class="search">
        <mat-icon>search</mat-icon>
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Search roles..." />
      </div>
      <div class="filter-container">
        <button 
          class="btn outline filter-btn" 
          (click)="toggleFilterDropdown()"
        >
          <mat-icon class="mr">filter_list</mat-icon>
          Filters
        </button>
      </div>
    </div>  <div class="table-wrapper">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Permissions</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (role of filteredRoles; track trackById($index, role)) {
          <tr class="row">
            <td>{{ role.name }}</td>
            <td>
              <span class="badge permissions-count">{{ role.permissions?.length || 0 }} permissions</span>
            </td>
            <td class="actions">
              <button class="icon" (click)="handleEditRole(role)" title="Edit Role">
                <mat-icon class="blue">edit</mat-icon>
              </button>
              <button class="icon" (click)="handleManagePermissions(role)" title="Manage Permissions">
                <mat-icon class="green">key</mat-icon>
              </button>
              <button 
                class="icon" 
                [disabled]="!canDeleteRole(role)"
                [title]="canDeleteRole(role) ? 'Eliminar Rol' : 'No se puede eliminar este rol'"
                (click)="handleDeleteRole(role)">
                <mat-icon [class]="canDeleteRole(role) ? 'red' : 'disabled'">delete</mat-icon>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="pagination">
    <div class="info">Showing <b>{{ startItem }}</b> to <b>{{ endItem }}</b> of <b>{{ totalFilteredRoles }}</b> results</div>
    <div class="pager">
      <button class="btn outline" (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
      @for (page of [].constructor(totalPages); track $index) {
        <button 
          class="btn" 
          [class.active]="currentPage === ($index + 1)"
          (click)="goToPage($index + 1)"
        >
          {{ $index + 1 }}
        </button>
      }
      <button class="btn outline" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>
</div>
