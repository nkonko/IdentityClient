  <div class="um-toolbar">
    <app-section-title></app-section-title>
  </div>

  <div class="card">
    <div class="card-toolbar">
      <div class="search">
        <mat-icon>search</mat-icon>
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" placeholder="Search users..." />
      </div>
      <div class="filter-container">
        <button 
          class="btn outline filter-btn" 
          (click)="toggleFilterDropdown()"
          [class.active]="activeFilterCount > 0"
        >
          <mat-icon class="mr">filter_list</mat-icon>
          Filters
          <span *ngIf="activeFilterCount > 0" class="filter-badge">{{ activeFilterCount }}</span>
        </button>
        
        <div class="filter-dropdown" [class.show]="showFilterDropdown">
          <div class="filter-section">
            <h4>Estado</h4>
            <div class="filter-options">
              <button 
                class="filter-option" 
                [class.active]="statusFilter === 'All'"
                (click)="selectStatusFilter('All')"
              >
                <span class="filter-label">Todos</span>
              </button>
              <button 
                class="filter-option" 
                [class.active]="statusFilter === 'Active'"
                (click)="selectStatusFilter('Active')"
              >
                <span class="status-indicator active"></span>
                <span class="filter-label">Activos</span>
              </button>
              <button 
                class="filter-option" 
                [class.active]="statusFilter === 'Inactive'"
                (click)="selectStatusFilter('Inactive')"
              >
                <span class="status-indicator inactive"></span>
                <span class="filter-label">Inactivos</span>
              </button>
              <button 
                class="filter-option" 
                [class.active]="statusFilter === 'Blocked'"
                (click)="selectStatusFilter('Blocked')"
              >
                <span class="status-indicator blocked"></span>
                <span class="filter-label">Bloqueados</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>User</th>
            <th>Role</th>
            <th>Status</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (user of filteredUsers; track trackById($index, user)) {
            <tr class="row">
              <td>
                <div class="user-cell">
                  <div class="avatar">{{ user.name?.charAt(0) }}</div>
                  <div class="user-meta">
                    <div class="name">{{ user.name }}</div>
                    <div class="email">{{ user.email }}</div>
                  </div>
                </div>
              </td>
              <td>
                <!-- <span [class]="getRoleClass(user.roles)">{{ user.roles }}</span> -->
              </td>
              <td>
                <span [class]="getStatusClass(user.status)">{{ user.status }}</span>
              </td>
              <td class="muted">{{ user.lastLogin }}</td>
              <td class="actions">
                <!-- Status action buttons based on current user status -->
                <button 
                  *ngIf="user.status !== 'Active'" 
                  class="icon" 
                  (click)="activateUser(user)" 
                  title="Activate User"
                >
                  <mat-icon class="green">check_circle</mat-icon>
                </button>
                
                <button 
                  *ngIf="user.status === 'Active'" 
                  class="icon" 
                  (click)="deactivateUser(user)" 
                  title="Deactivate User"
                >
                  <mat-icon class="orange">pause_circle</mat-icon>
                </button>
                
                <button 
                  *ngIf="user.status !== 'Blocked'" 
                  class="icon" 
                  (click)="blockUser(user)" 
                  title="Block User"
                >
                  <mat-icon class="red">block</mat-icon>
                </button>
                
                <button 
                  class="icon" 
                  (click)="deleteUser(user)" 
                  title="Delete User"
                >
                  <mat-icon class="red">delete</mat-icon>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <div class="info">Showing <b>{{ startItem }}</b> to <b>{{ endItem }}</b> of <b>{{ totalFilteredUsers }}</b> results</div>
      <div class="pager">
        <button class="btn outline" (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
        <button 
          class="btn" 
          [class.active]="currentPage === page"
          *ngFor="let page of [].constructor(totalPages); let i = index" 
          (click)="goToPage(i + 1)"
        >
          {{ i + 1 }}
        </button>
        <button class="btn outline" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
      </div>
    </div>
  </div>

