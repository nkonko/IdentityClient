<div class="profile-container">
  <div class="profile-content">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="profile-icon">person</mat-icon>
          Perfil de Usuario
        </mat-card-title>
        <mat-card-subtitle>Gestiona tu información personal</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        @if (isLoading) {
          <div class="loading-container">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Cargando perfil...</p>
          </div>
        }

        @if (!isLoading && user) {
          <div class="profile-form">
            <form [formGroup]="profileForm">
              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Usuario</mat-label>
                  <input matInput formControlName="userName" [readonly]="!isEditing">
                  <mat-icon matSuffix>person</mat-icon>
                  @if (profileForm.get('userName')?.hasError('required')) {
                    <mat-error>
                      El usuario es requerido
                    </mat-error>
                  }
                  @if (profileForm.get('userName')?.hasError('minlength')) {
                    <mat-error>
                      El usuario debe tener al menos 3 caracteres
                    </mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Email</mat-label>
                  <input matInput type="email" formControlName="email" [readonly]="!isEditing">
                  <mat-icon matSuffix>email</mat-icon>
                  @if (profileForm.get('email')?.hasError('required')) {
                    <mat-error>
                      El email es requerido
                    </mat-error>
                  }
                  @if (profileForm.get('email')?.hasError('email')) {
                    <mat-error>
                      Ingresa un email válido
                    </mat-error>
                  }
                </mat-form-field>
              </div>

              <mat-divider class="divider"></mat-divider>

              <div class="form-actions">
                @if (!isEditing) {
                  <div class="action-buttons">
                    <button mat-raised-button color="primary" (click)="toggleEdit()">
                      <mat-icon>edit</mat-icon>
                      Editar Perfil
                    </button>
                  </div>
                }

                @if (isEditing) {
                  <div class="action-buttons">
                    <button mat-stroked-button (click)="toggleEdit()" [disabled]="isLoading">
                      <mat-icon>cancel</mat-icon>
                      Cancelar
                    </button>
                    <button
                      mat-raised-button
                      color="primary"
                      (click)="saveProfile()"
                      [disabled]="!profileForm.valid || isLoading">
                      @if (!isLoading) {
                        <mat-icon>save</mat-icon>
                      }
                      @if (isLoading) {
                        <mat-spinner diameter="20"></mat-spinner>
                      }
                      {{ isLoading ? 'Guardando...' : 'Guardar Cambios' }}
                    </button>
                  </div>
                }
              </div>
            </form>
          </div>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>
